
# Call Stats

### Задание

Зарегистрироваться на GetBlock.io, используя API GetBlock создать сервис, выводящий адрес, баланс которого изменился (в любую сторону) больше остальных за последние сто блоков.

Получить номер последнего блока можно с помощью следующего метода:

https://getblock.io/docs/eth/json-rpc/eth_eth_blocknumber/

А данные блока вместе с транзакциями через

https://getblock.io/docs/eth/json-rpc/eth_eth_getblockbynumber/

Важно: API ключи в репозитории не хранить, не использовать пакеты go-ethereum и подобные ему

### Как запустить

```make run``` - запуск вне контейнера

```make build``` - билдит и запускает в контейнере через docker-compose

### Эндпоинты

```GET /api/v1/get_biggest_change?count_of_blocks=100``` - обычный get-запрос, описание с помощью Swagger находится в директории /docs.

```POST /``` - реализация метода json rpc *JsonRpc.GetBiggestChange* и принимает также параметр *countOfBlocks*.

Ответ на запрос содержит поля:

```
 {
    "address": "0xb739d0895772dbb71a89a3754a160269068f0d45",
    "amount": "0x4c6936edde9ed21430",
    "lastBlock": "0x12bbae8",
    "countOfBlocks": 100,
    "isRecieved": false
}
```

- *address* - адрес кошелька, баланс которого больше всего изменился;
- *amount* - модуль суммы значения на которое изменился кошелек;
- *lastBlock* - последний блок на момент запроса;
- *countOfBlocks* - количество последних блоков;
- *isRecieved* - указывает на знак изменения (true - приход средств).

### Конфигурация

Обязательной переменной окружения является ```API_URL```.

Файл с конфигурацией может указываться во флаге ```--config``` или переменной окружения ```CONFIG_PATH```. По умолчанию находится в файле */config/config.yml*.

### Кеширование

Из-за того что данные блока в блокчейне не могут быть переписаны, я решил использовать кеш хранящий изменения каждого адреса в блоке. Таким образом мы не вызываем вторично метод *eth_eth_getblockbynumber*. 

Сейчас емкость кеша = 100. Так как по заданию необходимо именно это число. Однако для более эффективных запросов для count_of_blocks > 100 стоит увеличить значение емкости.

### Лимитер

Из-за ограничения к серверу getblock.io (60 rps). Мы можем столкнуться с тем, что запросы будут отклонены. Чтобы решить эту проблему я сделал лимитер со статическими окном в 1 секунду. Однако это не дало сто процентой гарантии, поэтому добавил несколько попыток для каждого запроса.
